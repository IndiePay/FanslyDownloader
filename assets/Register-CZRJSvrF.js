import{_ as U}from"./Button-Ap4-f9jj.js";import{_ as $,a as z}from"./GoogleAuth.vue_vue_type_script_setup_true_lang-BnN7hFmx.js";import{ae as P,a9 as O,ad as Z,aa as o,ac as j}from"./index-X_YfJgbe.js";import{C as G,D as H,F as d,a2 as K,I as v,J as a,T as n,K as m,P as i,Q as w,ae as b,U as q,a4 as M,aB as F,aC as J,ap as Q,S as L,H as k}from"./common-C5Ua-Zla.js";import{e as W}from"./index-DSRwS_1G.js";const X={class:"flex-center w-full space-y-3"},Y={class:"space-y-3 w-full",md:"w-lg!"},ee=a("p",{text:"sm center"},"or",-1),te={class:"w-full space-y-3"},se={key:0,class:"text-sm"},oe={key:1,class:"text-sm text-dark"},ae={class:"flex items-center space-x-3"},ne={class:"w-full"},re=a("p",{class:"text-sm font-bold text-dark-50 text-center"}," Only one step left! Register or log in now to join our unlimited download family! ",-1),le={class:"font-bold text-dark-50 text-center"},fe=G({__name:"Register",setup(ie){P("Register");function C(e){return e=e.trim(),/^[0-9a-zA-Z_.-]+[@][0-9a-zA-Z_.-]+([.][a-zA-Z]+){1,2}$/.test(e)}const V=O(),D=Z();function I(){var e;V.push(((e=D.query)==null?void 0:e.next)||"/subscribe"),console.log("Auth successful.")}function R(e){console.log("Auth faild",e.message)}const T=M(j),t=H({email:T.value,password:"",code:""});let p=d(!1);const g=d(!1);let r=K(()=>{if(!t.email)return null;const e=W.run({email:t.email});if(g.value=!1,e){const s=t.email.split("@")[1];return e.domain!=s?{originDomain:s,suggestedDomain:e.domain}:null}else return null});const N=()=>{r.value&&(t.email=t.email.replace(r.value.originDomain,r.value.suggestedDomain))},_=d(!1),y=d("SEND CODE");function A(){if(t.email==""){o({type:"error",message:"Can't send code without email."});return}else{C(t.email)?e():o({type:"error",message:"Incorrect email address."});return}function e(){_.value=!0,F({email:t.email}).then(s=>{const{code:h,msg:u}=s;if(h==200){let c=function(){f>0?(y.value=f--+"s RESEND",setTimeout(c,1e3)):(y.value="SEND CODE",p.value=!1)};p.value=!0;let f=60;c()}else o({type:"error",message:u})}).catch(()=>{o({type:"error",message:"Send failed, please check your network connection and try again."})}),_.value=!1}}const x=d(!1);async function B(){var e;if(t.email==""){o({type:"error",message:"Email is required."});return}else if(!C(t.email)){o({type:"error",message:"Incorrect email address."});return}if(t.password==""){o({type:"error",message:"Password is required."});return}x.value=!0;try{const s=await J(t);Q(s),V.push(((e=D.query)==null?void 0:e.next)||"/")}catch(s){s.code==10001?o({type:"error",message:"The email address has been registered."}):o({type:"error",message:"Register failed, please check your network connection and try again."})}x.value=!1}return(e,s)=>{var E,S;const h=z,u=$,c=U,f=L("router-link");return k(),v("div",X,[a("div",Y,[n(h,{onSuccess:I,onError:R}),ee,a("div",te,[n(u,{modelValue:t.email,"onUpdate:modelValue":s[0]||(s[0]=l=>t.email=l),icon:"i-ant-design:mail-twotone text-blue-500",placeholder:"Email address",required:""},null,8,["modelValue"]),m(r)&&!g.value?(k(),v("p",se,[i("Are you sure the domain name is "),a("span",{class:"underline text-blue-500 cursor-pointer",onClick:s[1]||(s[1]=l=>g.value=!0)},w((E=m(r))==null?void 0:E.originDomain),1),i(" and not "),a("span",{class:"underline text-green-500 cursor-pointer",onClick:N},w((S=m(r))==null?void 0:S.suggestedDomain),1),i("?")])):b("",!0),m(p)?(k(),v("p",oe,"Code sent. If not received in 1 min, check email address.")):b("",!0),a("div",ae,[n(u,{class:"w-2/3",modelValue:t.code,"onUpdate:modelValue":s[2]||(s[2]=l=>t.code=l),icon:"i-bi:send-check-fill text-green-500",placeholder:"Verification code sent to your email",required:""},null,8,["modelValue"]),n(c,{class:"max-w-1/3",type:"primary",size:"large",loading:_.value,onClick:A,disabled:m(p)},{default:q(()=>[i(w(y.value),1)]),_:1},8,["loading","disabled"])]),n(u,{modelValue:t.password,"onUpdate:modelValue":s[3]||(s[3]=l=>t.password=l),icon:"i-ant-design:lock-twotone text-orange-500",placeholder:"Password",required:""},null,8,["modelValue"]),n(c,{loading:x.value,onClick:B,type:"primary",icon:"i-ic:twotone-security",text:"SIGN UP"},null,8,["loading"])])]),a("div",ne,[re,a("p",le,[i(" Have an account? "),n(f,{to:e.$route.query.next?`/login?next=${e.$route.query.next}`:"/login",class:"text-current underline underline-current"},{default:q(()=>[i("Sign in now.")]),_:1},8,["to"])])])])}}});export{fe as default};
