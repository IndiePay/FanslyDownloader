import{aq as n,ar as u}from"./common-_MJlLFcq.js";const r=async()=>{const t=await chrome.tabs.create({url:"https://fansly.com",active:!1}),o=(await chrome.scripting.executeScript({target:{tabId:t.id},func:()=>{const e=JSON.parse(localStorage.getItem("session_active_session")||"null");return e&&(e.deviceId=localStorage.getItem("device_device_id")||""),e}}))[0].result;return o?(await chrome.storage.local.set({session:o}),t.id&&chrome.tabs.remove(t.id),!0):(await chrome.windows.update(t.windowId,{focused:!0}),await chrome.tabs.update(t.id,{active:!0}),!1)};let i;const d=async()=>{await r()?i?chrome.windows.update(i,{focused:!0}):i=(await s("/")).id:chrome.tabs.create({url:"https://fansly.com",active:!0})};chrome.runtime.onInstalled.addListener(t=>{t.reason==chrome.runtime.OnInstalledReason.INSTALL&&d()});chrome.action.onClicked.addListener(async()=>{d()});chrome.runtime.onMessage.addListener((t,a,o)=>(t.method=="RECHECK"&&r().then(o),t=="GET_TOKEN"&&chrome.storage.local.get("token").then(({token:e})=>o(e)),t.method=="getAccountInfo"&&n().then(e=>{o(e)}),t.method=="updateQuota"&&n().then(e=>{if(!e)return o(!1);u(e.email,e.token,t.payload||1).then(c=>{o(c)})}),t.method=="createWindow"&&s(t.payload),t.method=="Download"&&chrome.downloads.download({url:t.url,filename:t.filename,conflictAction:"overwrite",saveAs:!1}),!0));async function s(t){const a=await chrome.system.display.getInfo(),o=1440,e=768,c=Math.ceil((a[0].bounds.width-o)/2),l=Math.ceil((a[0].bounds.height-e)/2),h=chrome.runtime.getURL(`index.html#${t}`);return await chrome.windows.create({url:h,type:"panel",focused:!0,width:o,height:e,left:c,top:l})}
