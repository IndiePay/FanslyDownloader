import{_ as z}from"./Button-D14Q4G7_.js";import{_ as P,a as O}from"./GoogleAuth.vue_vue_type_script_setup_true_lang-DlXvwi_H.js";import{ad as U,a9 as n,a8 as Z,ac as $,ab as H}from"./index-C0avKrge.js";import{C as K,D as M,F as c,a0 as j,I as w,J as i,R as a,K as o,N as u,O as C,ac as N,S as A,a2 as F,az as G,aB as J,Q,H as k}from"./common-BIwoD4Gb.js";import{e as W}from"./index-DmSlregc.js";import"./_commonjsHelpers-BosuxZz1.js";const L={class:"space-y-3 w-full",md:"w-lg!"},X={class:"w-full space-y-3"},Y={key:0,class:"text-sm"},ee={key:1,class:"text-sm text-dark"},te={class:"flex items-center space-x-3"},se={class:"text-sm font-bold text-dark-50 text-center"},de=K({__name:"Reset",setup(oe){U("Register");function D(s){return s=s.trim(),/^[0-9a-zA-Z_.-]+[@][0-9a-zA-Z_.-]+([.][a-zA-Z]+){1,2}$/.test(s)}const E=F(H),t=M({email:E.value,password:"",code:""});let p=c(!1);const g=c(!1);let l=j(()=>{if(!t.email)return null;const s=W.run({email:t.email});if(g.value=!1,s){const e=t.email.split("@")[1];return s.domain!=e?{originDomain:e,suggestedDomain:s.domain}:null}else return null});const I=()=>{l.value&&(t.email=t.email.replace(l.value.originDomain,l.value.suggestedDomain))},y=c(!1),_=c("SEND CODE");function T(){if(t.email==""){n({type:"error",message:"Can't send code without email."});return}else{D(t.email)?s():n({type:"error",message:"Incorrect email address."});return}function s(){y.value=!0,G({email:t.email}).then(e=>{const{code:v,msg:d}=e;if(v==200){let m=function(){f>0?(_.value=f--+"s RESEND",setTimeout(m,1e3)):(_.value="SEND CODE",p.value=!1)};p.value=!0;let f=60;m()}else n({type:"error",message:d})}).catch(()=>{n({type:"error",message:"Send failed, please check your network connection and try again."})}),y.value=!1}}const V=Z(),x=c(!1);async function b(){if(t.email==""){n({type:"error",message:"Email is required."});return}else if(!D(t.email)){n({type:"error",message:"Incorrect email address."});return}if(t.password==""){n({type:"error",message:"Password is required."});return}x.value=!0;try{(await J(t)).code==200&&(E.value=t.email,V.push("/login"))}catch(s){console.log(s)}x.value=!1}const h=$();function q(){var s;V.push(((s=h.query)==null?void 0:s.next)||"/"),console.log("Auth successful.")}function B(s){console.log("Auth faild",s.message)}return(s,e)=>{var S,R;const v=O,d=P,m=z,f=Q("router-link");return k(),w("div",L,[i("div",X,[a(v,{onSuccess:q,onError:B}),e[9]||(e[9]=i("p",{text:"sm center"},"or",-1)),a(d,{modelValue:o(t).email,"onUpdate:modelValue":e[0]||(e[0]=r=>o(t).email=r),icon:"i-ant-design:mail-twotone text-blue-500",placeholder:"Email address",required:""},null,8,["modelValue"]),o(l)&&!o(g)?(k(),w("p",Y,[e[4]||(e[4]=u("Are you sure the domain name is ")),i("span",{class:"underline text-blue-500 cursor-pointer",onClick:e[1]||(e[1]=r=>g.value=!0)},C((S=o(l))==null?void 0:S.originDomain),1),e[5]||(e[5]=u(" and not ")),i("span",{class:"underline text-green-500 cursor-pointer",onClick:I},C((R=o(l))==null?void 0:R.suggestedDomain),1),e[6]||(e[6]=u("?"))])):N("",!0),o(p)?(k(),w("p",ee,"Code sent. If not received in 1 min, check email address.")):N("",!0),i("div",te,[a(d,{class:"w-2/3",modelValue:o(t).code,"onUpdate:modelValue":e[2]||(e[2]=r=>o(t).code=r),icon:"i-bi:send-check-fill text-green-500",placeholder:"Verification code sent to your email",required:""},null,8,["modelValue"]),a(m,{class:"max-w-1/3",type:"primary",size:"large",loading:o(y),onClick:T,disabled:o(p)},{default:A(()=>[u(C(o(_)),1)]),_:1},8,["loading","disabled"])]),a(d,{modelValue:o(t).password,"onUpdate:modelValue":e[3]||(e[3]=r=>o(t).password=r),icon:"i-ant-design:lock-twotone text-orange-500",placeholder:"New Password",required:""},null,8,["modelValue"]),a(m,{loading:o(x),onClick:b,type:"primary",icon:"i-fluent:key-reset-24-filled",text:"RESET PASSWORD"},null,8,["loading"]),i("p",se,[e[8]||(e[8]=u(" Have an account? ")),a(f,{to:"/login",class:"text-current underline underline-current"},{default:A(()=>e[7]||(e[7]=[u("Sign in now.")])),_:1})])])])}}});export{de as default};
