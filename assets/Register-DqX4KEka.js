import{_ as B}from"./Button-D14Q4G7_.js";import{_ as U,a as j}from"./GoogleAuth.vue_vue_type_script_setup_true_lang-DlXvwi_H.js";import{ad as O,a8 as F,ac as P,a9 as o,ab as Z}from"./index-C0avKrge.js";import{C as G,D as H,F as c,a0 as K,I as f,K as i,ac as V,J as n,R as a,N as u,O as b,S as q,a2 as M,az as J,aA as Q,ao as L,Q as W,H as y}from"./common-BIwoD4Gb.js";import{e as X}from"./index-DmSlregc.js";import"./_commonjsHelpers-BosuxZz1.js";const Y={class:"flex-center w-full space-y-3"},ee={key:0,class:"px-4 py-2 flex items-center justify-center mb-4 w-lg space-x-1 rounded-md bg-orange-200 text-sm text-dark-50"},te={class:"space-y-3 w-full",md:"w-lg!"},se={class:"w-full space-y-3"},oe={key:0,class:"text-sm"},ne={key:1,class:"text-sm text-dark"},ae={class:"flex items-center space-x-3"},re={class:"w-full"},le={class:"font-bold text-dark-50 text-center"},fe=G({__name:"Register",setup(ie){O("Register");function D(t){return t=t.trim(),/^[0-9a-zA-Z_.-]+[@][0-9a-zA-Z_.-]+([.][a-zA-Z]+){1,2}$/.test(t)}const E=F(),x=P(),R=x.query.from;function I(){var t;E.push(((t=x.query)==null?void 0:t.next)||"/subscribe"),console.log("Auth successful.")}function N(t){console.log("Auth faild",t.message)}const A=M(Z),s=H({email:A.value,password:"",code:""});let p=c(!1);const v=c(!1);let r=K(()=>{if(!s.email)return null;const t=X.run({email:s.email});if(v.value=!1,t){const e=s.email.split("@")[1];return t.domain!=e?{originDomain:e,suggestedDomain:t.domain}:null}else return null});const T=()=>{r.value&&(s.email=s.email.replace(r.value.originDomain,r.value.suggestedDomain))},_=c(!1),w=c("SEND CODE");function $(){if(s.email==""){o({type:"error",message:"Can't send code without email."});return}else{D(s.email)?t():o({type:"error",message:"Incorrect email address."});return}function t(){_.value=!0,J({email:s.email}).then(e=>{const{code:C,msg:d}=e;if(C==200){let m=function(){g>0?(w.value=g--+"s RESEND",setTimeout(m,1e3)):(w.value="SEND CODE",p.value=!1)};p.value=!0;let g=60;m()}else o({type:"error",message:d})}).catch(()=>{o({type:"error",message:"Send failed, please check your network connection and try again."})}),_.value=!1}}const k=c(!1);async function z(){var t;if(s.email==""){o({type:"error",message:"Email is required."});return}else if(!D(s.email)){o({type:"error",message:"Incorrect email address."});return}if(s.password==""){o({type:"error",message:"Password is required."});return}k.value=!0;try{const e=await Q(s);L(e),E.push(((t=x.query)==null?void 0:t.next)||"/")}catch(e){e.code==10001?o({type:"error",message:"The email address has been registered."}):o({type:"error",message:"Register failed, please check your network connection and try again."})}k.value=!1}return(t,e)=>{var S,h;const C=j,d=U,m=B,g=W("router-link");return y(),f("div",Y,[i(R)=="content"?(y(),f("div",ee," Free trial quota has been used up, join us to get more quota.")):V("",!0),n("div",te,[a(C,{onSuccess:I,onError:N}),e[7]||(e[7]=n("p",{text:"sm center"},"or",-1)),n("div",se,[a(d,{modelValue:s.email,"onUpdate:modelValue":e[0]||(e[0]=l=>s.email=l),icon:"i-ant-design:mail-twotone text-blue-500",placeholder:"Email address",required:""},null,8,["modelValue"]),i(r)&&!v.value?(y(),f("p",oe,[e[4]||(e[4]=u("Are you sure the domain name is ")),n("span",{class:"underline text-blue-500 cursor-pointer",onClick:e[1]||(e[1]=l=>v.value=!0)},b((S=i(r))==null?void 0:S.originDomain),1),e[5]||(e[5]=u(" and not ")),n("span",{class:"underline text-green-500 cursor-pointer",onClick:T},b((h=i(r))==null?void 0:h.suggestedDomain),1),e[6]||(e[6]=u("?"))])):V("",!0),i(p)?(y(),f("p",ne,"Code sent. If not received in 1 min, check email address.")):V("",!0),n("div",ae,[a(d,{class:"w-2/3",modelValue:s.code,"onUpdate:modelValue":e[2]||(e[2]=l=>s.code=l),icon:"i-bi:send-check-fill text-green-500",placeholder:"Verification code sent to your email",required:""},null,8,["modelValue"]),a(m,{class:"max-w-1/3",type:"primary",size:"large",loading:_.value,onClick:$,disabled:i(p)},{default:q(()=>[u(b(w.value),1)]),_:1},8,["loading","disabled"])]),a(d,{modelValue:s.password,"onUpdate:modelValue":e[3]||(e[3]=l=>s.password=l),icon:"i-ant-design:lock-twotone text-orange-500",placeholder:"Password",required:""},null,8,["modelValue"]),a(m,{loading:k.value,onClick:z,type:"primary",icon:"i-ic:twotone-security",text:"SIGN UP"},null,8,["loading"])])]),n("div",re,[e[10]||(e[10]=n("p",{class:"text-sm font-bold text-dark-50 text-center"}," Only one step left! Register or log in now to join our unlimited download family! ",-1)),n("p",le,[e[9]||(e[9]=u(" Have an account? ")),a(g,{to:t.$route.query.next?`/login?next=${t.$route.query.next}`:"/login",class:"text-current underline underline-current"},{default:q(()=>e[8]||(e[8]=[u("Sign in now.")])),_:1},8,["to"])])])])}}});export{fe as default};
